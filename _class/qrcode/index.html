<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>QR Code</title>
    <!-- 引入easy.qrcode.min.js库 -->
    <script src="./_js/easy.qrcode.min.js"></script>
    <script src="./_js/html5-qrcode.min.js"></script>
    <style>
        /* 自定义textarea的样式 */
        #content {
            width: 300px; /* 调整textarea的宽度 */
            padding: 10px; /* 添加内边距 */
            resize: vertical; /* 允许垂直调整大小 */
        }
    </style>
</head>
<body>
    <!-- 生成二维码 -->
    <h2>QR Code Generator</h2>
    <textarea id="content" oninput="generateQRCode()" placeholder="输入内容"></textarea>
    <div id="qrcode"></div>


    <!-- 扫描二维码 -->
    <h2>QR Code Scanner</h2>
    <div id="qr-reader" style="width: 600px"></div>
    <div id="result"></div>

	
    <script>
		//生成二维码
        // 获取textarea和二维码显示区域的引用
        var textareaElement = document.getElementById("content");
        var qrcodeElement = document.getElementById("qrcode");
        var qrcode = null; // 用于存储QRCode对象的引用

        // 当textarea内容变化时生成二维码
        function generateQRCode() {
            var content = textareaElement.value;

            // 如果之前存在二维码，则先清空
            if (qrcode) {
                qrcode.clear();
            }

            // Options
            var options = {
                text: content
            };

            // 创建QRCode对象并显示二维码
            qrcode = new QRCode(qrcodeElement, options);
        }

        // 从URL参数中获取文本并填充到输入框
        function populateFromURLParam() {
            var urlParams = new URLSearchParams(window.location.search);
            var txtValue = urlParams.get("txt");
            if (txtValue) {
                // 如果存在"txt"参数，则将其值填充到textarea中
                textareaElement.value = txtValue;
                // 然后生成二维码
                generateQRCode();
            }
        }

        // 页面加载时初始化
        window.onload = function() {
            populateFromURLParam(); // 从URL参数填充内容
        };
    </script>
	
    <script>
		//扫描二维码
        // Function to handle successful scans and display results
        function onScanSuccess(decodedText, decodedResult) {
            var resultElement = document.getElementById("result");
            resultElement.textContent = `Code scanned = ${decodedText}`;
        }

        // Initialize the QR code scanner
        var html5QrcodeScanner = new Html5QrcodeScanner(
            "qr-reader", { fps: 10, qrbox: 250 }
        );

        // Render the scanner
        html5QrcodeScanner.render(onScanSuccess);
    </script>
</body>
</html>
